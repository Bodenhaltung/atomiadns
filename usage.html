<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>3. Usage</title><link rel="stylesheet" href="resources/css/style.css" type="text/css" /><meta name="generator" content="DocBook XSL Stylesheets V1.75.2" /><link rel="home" href="index.html" title="Home" /><link rel="up" href="index.html" title="Home" /><link rel="prev" href="features.html" title="2. Atomia DNS Features" /><link rel="next" href="faq.html" title="4. FAQ" /><script xmlns="" type="text/javascript" src="resources/js/jquery-1.7.1.min.js"></script><script xmlns="" type="text/javascript" src="resources/js/custom.js"></script></head><body><div xmlns="" class="header"><a title="Home" href="http://atomia.github.com/atomiadns/" id="books_home"><img alt="Atomia Docs" src="resources/img/a-docs.png" class="logo" /></a><div class="top_nav"><ul class="books"><li><a title="Home" href="index.html" id="books_home">Home</a><ul class="sub_home"><li><a href="overview.html">Atomia DNS Overview</a></li><li><a href="features.html">Atomia DNS Features</a></li><li><a href="usage.html">Usage</a></li><li><a href="faq.html">FAQ</a></li><li><a href="apidocs.html">Atomia DNS API</a></li></ul></li><li class="current"><a href="javascript:void(0);">Atomia DNS Master server</a><ul><li><a href="usage.html#usage-master-server">Atomia DNS Master server</a></li><li><a href="usage.html#usage-bind-dlz">Atomia DNS Bind-DLZ Nameserver</a></li><li><a href="usage.html#usage-powerdns">Atomia DNS PowerDNS Nameserver</a></li><li><a href="usage.html#usage-dyndns">Atomia DNS DynDNS</a></li></ul></li></ul><ul class="pager"><li><a id="pager_prev" href="features.html">Prev - Atomia DNS Features</a></li><li><a id="pager_next" href="faq.html">Next - FAQ</a></li></ul></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="usage"></a>3. Usage</h2></div></div></div>
    
    <div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
        <p>
          <a class="link" href="usage.html#usage-master-server" title="3.1. Atomia DNS Master server">Atomia DNS Master server</a>
        </p>
      </li><li class="listitem">
        <p>
          <a class="link" href="usage.html#usage-bind-dlz" title="3.2. Atomia DNS Bind-DLZ Nameserver">Atomia DNS Bind-DLZ Nameserver</a>
        </p>
      </li><li class="listitem">
        <p>
          <a class="link" href="usage.html#usage-powerdns" title="3.3. Atomia DNS PowerDNS Nameserver">Atomia DNS PowerDNS Nameserver</a>
        </p>
      </li><li class="listitem">
        <p>
          <a class="link" href="usage.html#usage-dyndns" title="3.4. Atomia DNS DynDNS">Atomia DNS DynDNS</a>
        </p>
      </li></ul></div>
    <div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="usage-master-server"></a>3.1. Atomia DNS Master server</h3></div></div></div>
      
      <div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="usage-master-whatis"></a>3.1.1. What is the Atomia DNS Master server?</h4></div></div></div>
        
        <p>The master server includes the Atomia DNS API that is used for communicating with the nameservers and also used by external applications to provision DNS data. Also on the master server is the Atomia DNS database which contains DNS settings for all nameservers. It is possible to install the Atomia DNS API and Atomia DNS database on different machines.</p>
      </div>
      <div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="usage-master-docs"></a>3.1.2. Atomia DNS Master server documentation</h4></div></div></div>
        
        <p>Please locate the desired information in one of the following sections:</p>
        <div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
            <p>
              <a class="link" href="usage.html#usage-master-installation" title="3.1.3. Atomia DNS Master server installation">Atomia DNS Master server installation</a>
            </p>
          </li><li class="listitem">
            <p>
              <a class="link" href="usage.html#usage-master-configuration" title="3.1.4. Atomia DNS Master server configuration">Atomia DNS Master server configuration</a>
            </p>
          </li><li class="listitem">
            <p>
              <a class="link" href="usage.html#usage-master-updates" title="3.1.5. Atomia DNS Master server updates">Atomia DNS Master server updates</a>
            </p>
          </li><li class="listitem">
            <p>
              <a class="link" href="usage.html#usage-master-usage" title="3.1.6. Atomia DNS Master server usage">Atomia DNS Master server usage</a>
            </p>
          </li><li class="listitem">
            <p>
              <a class="link" href="usage.html#usage-master-techinfo" title="3.1.7. Master database">Atomia DNS Master server technical information</a>
            </p>
          </li></ul></div>
      </div>
      <div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="usage-master-installation"></a>3.1.3. Atomia DNS Master server installation</h4></div></div></div>
        
        <div class="section"><div class="titlepage"><div><div><h5 class="title"><a id="usage-master-installation-types"></a>3.1.3.1. Installation</h5></div></div></div>
          
          <p>The Atomia DNS Master server consists of two different parts, the Atomia DNS database and the Atomia DNS API. It is possible to install the Atomia DNS Master server either with the database and the API on the same machine or on different machines. The default and recommended way is to install both on the same machine. In addition, if you want to use DNSSEC, it consists of an optional step where you add the initial DNSSEC keyset.</p>
          <div class="section"><div class="titlepage"><div><div><h6 class="title"><a id="usage-master-installation-default-header"></a>3.1.3.1.1. Default installation</h6></div></div></div>
            
            <p>The default installation will install both the Atomia DNS database and the Atomia DNS API.</p>
            <p>
              See
              <a class="link" href="usage.html#usage-master-installation-default" title="3.1.3.4. Atomia DNS Master server default installation">Atomia DNS Master server default installation</a>
              for instructions.
            </p>
          </div>
          <div class="section"><div class="titlepage"><div><div><h6 class="title"><a id="usage-master-installation-manual-header"></a>3.1.3.1.2. Manual installation</h6></div></div></div>
            
            <p>Using the manual installation guide you can install separate packages and have the Atomia DNS database and the Atomia DNS API on separate machines.</p>
            <p>
              See
              <a class="link" href="usage.html#usage-master-installation-manual" title="3.1.3.5. Atomia DNS Master server manual installation">Atomia DNS Master server manual installation</a>
              for instructions.
            </p>
          </div>
          <div class="section"><div class="titlepage"><div><div><h6 class="title"><a id="usage-master-installation-dnssec-header"></a>3.1.3.1.3. Creating the initial DNSSEC keyset</h6></div></div></div>
            
            <p>For using DNSSEC you need to create the initial keys used to sign your zones.</p>
            <p>
              See
              <a class="link" href="usage.html#usage-master-installation-dnssec" title="3.1.3.6. Creating the initial DNSSEC keyset">Creating the initial DNSSEC keyset</a>
              for instructions.
            </p>
          </div>
        </div>
        <div class="section"><div class="titlepage"><div><div><h5 class="title"><a id="usage-master-installation-schema"></a>3.1.3.2. The database schema</h5></div></div></div>
          
          <p>
            The package will create a database called
            <span class="italics">zonedata</span>
            if it doesn't exist, and create the schema there.
          </p>
          <p>If the database already exists, there are two cases:</p>
          <div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">
              <p>The schema is already installed correctly and the installer proceeds.</p>
            </li><li class="listitem">
              <p>The database contains something which is not a version of the Atomia DNS schema and the installer fails.</p>
            </li></ol></div>
          <p>
            To be able to install the product if you already have a database called
            <span class="italics">zonedata</span>
            you need to remove or rename that database, or manually install the latest version of the schema to the database, then rerun the installer.
          </p>
        </div>
        <div class="section"><div class="titlepage"><div><div><h5 class="title"><a id="usage-master-installation-software"></a>3.1.3.3. Software used by Atomia DNS Master server</h5></div></div></div>
          
          <p>On the Atomia DNS Master server the following software is needed (in the recommended installation with Atomia DNS API and Atomia DNS database on the same machine):</p>
          <div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
              <p>
                <span class="italics">Atomia::DNS::Server</span>
              </p>
            </li><li class="listitem">
              <p>
                <span class="italics">Apache2 with mod_perl2</span>
              </p>
            </li><li class="listitem">
              <p>
                <span class="italics">Postgresql 8.3 or later</span>
              </p>
            </li><li class="listitem">
              <p>
                <span class="italics">DBD::Pg 2.11.7 or later</span>
              </p>
            </li><li class="listitem">
              <p>
                <span class="italics">SOAP::Lite 0.810.08 or later</span>
              </p>
            </li><li class="listitem">
              <p>
                <span class="italics">Moose</span>
              </p>
            </li><li class="listitem">
              <p>
                <span class="italics">Config::General</span>
              </p>
            </li></ul></div>
          <p>
            All needed software, including prerequisites, is installed by the provided package,
            <span class="italics">atomiadns-masterserver</span>
            .
          </p>
        </div>
        <div class="section"><div class="titlepage"><div><div><h5 class="title"><a id="usage-master-installation-default"></a>3.1.3.4. Atomia DNS Master server default installation</h5></div></div></div>
          
          <div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
              <p>
                <a class="link" href="usage.html#usage-master-installation-default-intro" title="3.1.3.4.1. Introduction">Introduction</a>
              </p>
            </li><li class="listitem">
              <p>
                <a class="link" href="usage.html#usage-master-installation-default-ubuntu" title="3.1.3.4.2. Installation on Ubuntu 10.04 LTS">Installation on Ubuntu 10.04 LTS</a>
              </p>
            </li><li class="listitem">
              <p>
                <a class="link" href="usage.html#usage-master-installation-default-freebsd" title="3.1.3.4.3. Installation on FreeBSD">Installation on FreeBSD</a>
              </p>
            </li><li class="listitem">
              <p>
                <a class="link" href="usage.html#usage-master-installation-default-rhel4" title="3.1.3.4.4. Installation on Redhat Enterprise Linux 4">Installation on Redhat Enterprise Linux 4</a>
              </p>
            </li><li class="listitem">
              <p>
                <a class="link" href="usage.html#usage-master-installation-default-rhel5" title="3.1.3.4.5. Installation on Redhat Enterprise Linux 5">Installation on Redhat Enterprise Linux 5</a>
              </p>
            </li><li class="listitem">
              <p>
                <a class="link" href="usage.html#usage-master-installation-default-rhel6" title="3.1.3.4.6. Installation on Redhat Enterprise Linux 6">Installation on Redhat Enterprise Linux 6</a>
              </p>
            </li><li class="listitem">
              <p>
                <a class="link" href="usage.html#usage-master-installation-default-troubleshoot" title="3.1.3.4.7. Installation troubleshooting">Installation troubleshooting</a>
              </p>
            </li></ul></div>
          <div class="section"><div class="titlepage"><div><div><h6 class="title"><a id="usage-master-installation-default-intro"></a>3.1.3.4.1. Introduction</h6></div></div></div>
            
            <p>This guide will install the Atomia DNS Master server using a default installation. This means that both the Atomia DNS database and Atomia DNS API will be installed.</p>
          </div>
          <div class="section"><div class="titlepage"><div><div><h6 class="title"><a id="usage-master-installation-default-ubuntu"></a>3.1.3.4.2. Installation on Ubuntu 10.04 LTS</h6></div></div></div>
            
            <div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">
                <p>
                  Do a standard installation of Ubuntu 10.04 LTS.
                </p>
              </li><li class="listitem">
                <p>
                  Add the Atomia APT Repository to the server using:
                  </p><pre class="programlisting">wget -q -O - http://public.apt.atomia.com/setup.sh.shtml | sed s/%distcode/`lsb_release -c | awk '{ print $2 }'`/g | sh</pre><p>
                </p>
              </li><li class="listitem">
                <p>Update all packages:</p>
                <div class="informalexample">
                  <pre class="programlisting">apt-get update</pre>
                </div>
              </li><li class="listitem">
                <p>Install the Atomia DNS Master:</p>
                <div class="informalexample">
                  <pre class="programlisting">apt-get install atomiadns-masterserver</pre>
                </div>
              </li><li class="listitem">
                <p>Add the initial DNSSEC keyset (optional):</p>
            	<p>
			See <a class="link" href="usage.html#usage-master-installation-dnssec" title="3.1.3.6. Creating the initial DNSSEC keyset">Creating the initial DNSSEC keyset</a> for instructions.
		</p>
              </li></ol></div>
          </div>
          <div class="section"><div class="titlepage"><div><div><h6 class="title"><a id="usage-master-installation-default-freebsd"></a>3.1.3.4.3. Installation on FreeBSD</h6></div></div></div>
            
            <div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">
                <p>
                  Do a standard installation of FreeBSD. The instructions where tested with FreeBSD 9.0-RELEASE, but should work on
                  other versions as well.
                </p>
              </li><li class="listitem">
                <p>
                  Make sure you have an up-to-date ports collection, as described in
                  <a class="ulink" href="http://www.freebsd.org/doc/en_US.ISO8859-1/books/handbook/updating-upgrading-portsnap.html" target="_top">the FreeBSD handbook</a>.
                </p>
              </li><li class="listitem">
                <p>
		  </p><p xmlns="" class="note">This step is only neccessary as long as the Atomia DNS ports are not in the main ports collection</p><p>
		  </p><div class="informalexample">
		  	<pre class="programlisting">cd /usr/ports/dns ; fetch -q -o - https://github.com/atomia/atomiadns/tarball/develop | tar xvfpz - --strip-components 2 "*/freebsd"</pre>
		  </div><p>
                </p>
              </li><li class="listitem">
                <p>Install PostgreSQL:</p>
                <div class="informalexample">
                  <pre class="programlisting">
                  	cd /usr/ports/databases/postgresql91-server
                  	make BATCH=yes all install
			echo 'postgresql_enable="YES"' &gt;&gt; /etc/rc.conf
			/usr/local/etc/rc.d/postgresql initdb
			/usr/local/etc/rc.d/postgresql start
                 </pre>
                </div>
              </li><li class="listitem">
                <p>Install Atomia DNS:</p>
                <div class="informalexample">
                  <pre class="programlisting">
			cd /usr/ports/atomiadns-database
			make BATCH=yes all install
			atomiadns-sync-database
			cd /usr/ports/atomiadns-api
			make BATCH=yes all install
			cd /usr/ports/atomiadns-client
			make BATCH=yes all install
			echo 'apache22_enable="YES"' &gt;&gt; /etc/rc.conf
                 </pre>
                </div>
              </li><li class="listitem">
                <p>Test the installation by creating your first (and often only) nameserver group:</p>
                <div class="informalexample">
                  <pre class="programlisting">
                  	atomiadnsclient --method AddNameserverGroup --arg default
                 </pre>
                </div>
              </li><li class="listitem">
                <p>Add the initial DNSSEC keyset (optional):</p>
            	<p>
			See <a class="link" href="usage.html#usage-master-installation-dnssec" title="3.1.3.6. Creating the initial DNSSEC keyset">Creating the initial DNSSEC keyset</a> for instructions.
		</p>
              </li></ol></div>
          </div>
          <div class="section"><div class="titlepage"><div><div><h6 class="title"><a id="usage-master-installation-default-rhel4"></a>3.1.3.4.4. Installation on Redhat Enterprise Linux 4</h6></div></div></div>
			<p xmlns="" class="note">We no longer recommend Redhat Enterprise Linux 4, latest version supported is Redhat Enterprise Linux 6</p>
            
            <div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">
                <p>First setup the needed repositories.</p>
                <div class="informalexample">
                  <pre class="programlisting">rpm -Uhv http://apt.sw.be/redhat/el4/en/i386/rpmforge/RPMS/rpmforge-release-0.3.6-1.el4.rf.i386.rpm
rpm -Uhv http://yum.pgsqlrpms.org/reporpms/8.4/pgdg-redhat-8.4-1.noarch.rpm
rpm -Uhv http://rpm.atomia.com/rhel4/atomia-repository-setup-1.0-1.noarch.rpm
                  </pre>
                </div>
              </li><li class="listitem">
                <p>Next install the Atomia DNS master server</p>
                <div class="informalexample">
                  <pre class="programlisting">up2date -i atomiadns-masterserver</pre>
                </div>
              </li><li class="listitem">
                <p>Allow md5 authentication instead of ident for connections to 127.0.0.1/32 in /var/lib/pgsql/data/pg_hba.conf, example row:</p>
                <div class="informalexample">
                  <pre class="programlisting">host    all         all         127.0.0.1/32          md5</pre>
                </div>
              </li><li class="listitem">
                <p>Restart postgresql:</p>
                <div class="informalexample">
                  <pre class="programlisting">service postgresql restart</pre>
                </div>
              </li></ol></div>
          </div>
          <div class="section"><div class="titlepage"><div><div><h6 class="title"><a id="usage-master-installation-default-rhel5"></a>3.1.3.4.5. Installation on Redhat Enterprise Linux 5</h6></div></div></div>
            
			<p xmlns="" class="note">We no longer recommend Redhat Enterprise Linux 5, latest version supported is Redhat Enterprise Linux 6</p>
            <div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">
                <p>First setup the needed repositories.</p>
                <div class="informalexample">
                  <pre class="programlisting">rpm -Uhv http://apt.sw.be/redhat/el5/en/i386/rpmforge/RPMS/rpmforge-release-0.3.6-1.el5.rf.i386.rpm
rpm -Uhv http://yum.pgsqlrpms.org/reporpms/8.4/pgdg-redhat-8.4-1.noarch.rpm
rpm -Uhv http://rpm.atomia.com/rhel5/atomia-repository-setup-1.0-1.noarch.rpm
                  </pre>
                </div>
              </li><li class="listitem">
                <p>Next install the Atomia DNS master server</p>
                <div class="informalexample">
                  <pre class="programlisting">yum install atomiadns-masterserver</pre>
                </div>
              </li><li class="listitem">
                <p>Allow md5 authentication instead of ident for connections to 127.0.0.1/32 in /var/lib/pgsql/data/pg_hba.conf, example row:</p>
                <div class="informalexample">
                  <pre class="programlisting">host    all         all         127.0.0.1/32          md5</pre>
                </div>
              </li><li class="listitem">
                <p>Restart postgresql:</p>
                <div class="informalexample">
                  <pre class="programlisting">service postgresql restart</pre>
                </div>
              </li></ol></div>
          </div>
          <div class="section"><div class="titlepage"><div><div><h6 class="title"><a id="usage-master-installation-default-rhel6"></a>3.1.3.4.6. Installation on Redhat Enterprise Linux 6</h6></div></div></div>
            
            <div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">
                <p>First setup the needed repositories.</p>
                <div class="informalexample">
                  <pre class="programlisting">rpm -Uhv http://apt.sw.be/redhat/el6/en/i386/rpmforge/RPMS/rpmforge-release-0.5.2-2.el6.rf.i686.rpm
rpm -Uhv http://yum.pgsqlrpms.org/reporpms/8.4/pgdg-redhat-8.4-1.noarch.rpm
rpm -Uhv http://public.rpm.atomia.com/rhel6/atomia-public-repository-setup-1.0-1.el6.noarch.rpm
                  </pre>
                </div>
              </li><li class="listitem">
                <p>Next install the Atomia DNS master server</p>
                <div class="informalexample">
                  <pre class="programlisting">yum install atomiadns-masterserver</pre>
                </div>
              </li><li class="listitem">
                <p>Allow md5 authentication instead of ident for connections to 127.0.0.1/32 in /var/lib/pgsql/data/pg_hba.conf, example row:</p>
                <div class="informalexample">
                  <pre class="programlisting">host    all         all         127.0.0.1/32          md5</pre>
                </div>
              </li><li class="listitem">
                <p>Restart postgresql:</p>
                <div class="informalexample">
                  <pre class="programlisting">service postgresql restart</pre>
                </div>
              </li></ol></div>
          </div>
          <div class="section"><div class="titlepage"><div><div><h6 class="title"><a id="usage-master-installation-default-troubleshoot"></a>3.1.3.4.7. Installation troubleshooting</h6></div></div></div>
            
          </div>
        </div>
        <div class="section"><div class="titlepage"><div><div><h5 class="title"><a id="usage-master-installation-manual"></a>3.1.3.5. Atomia DNS Master server manual installation</h5></div></div></div>
          
          <p>This guide will install the Atomia DNS Master server with the Atomia DNS database on a separate server from the Atomia DNS API.</p>
          <div class="section"><div class="titlepage"><div><div><h6 class="title"><a id="usage-master-installation-manual-ubuntu"></a>3.1.3.5.1. Installation on Ubuntu 10.04 LTS</h6></div></div></div>
            
            <div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">
                <p>
                  Do a standard installation of Ubuntu 10.04 LTS on two servers.
                </p>
              </li><li class="listitem">
                <p>On both servers:</p>
                <div class="orderedlist"><ol class="orderedlist" type="a"><li class="listitem">
                    <p>
                  	Add the Atomia APT Repository to the server using:
	                </p><pre class="programlisting">wget -q -O - http://public.apt.atomia.com/setup.sh.shtml | sed s/%distcode/`lsb_release -c | awk '{ print $2 }'`/g | sh</pre><p>
                    </p>
                  </li><li class="listitem">
                    <p>Update all packages:</p>
                    <div class="informalexample">
                      <pre class="programlisting">apt-get update</pre>
                    </div>
                  </li></ol></div>
              </li><li class="listitem">
                <p>Assign one of the servers to be Atomia DNS database server, on that server execute the following steps:</p>
                <div class="orderedlist"><ol class="orderedlist" type="a"><li class="listitem">
                    <p>Install the Atomia DNS database:</p>
                    <div class="informalexample">
                      <pre class="programlisting">apt-get install atomiadns-database</pre>
                    </div>
                  </li></ol></div>
              </li><li class="listitem">
                <p>Assign one of the servers to be Atomia DNS API server, on that server execute the following steps:</p>
                <div class="orderedlist"><ol class="orderedlist" type="a"><li class="listitem">
                    <p>Install the Atomia DNS API:</p>
                    <div class="informalexample">
                      <pre class="programlisting">apt-get install atomiadns-api</pre>
                    </div>
                  </li></ol></div>
              </li></ol></div>
          </div>
        </div>
        <div class="section"><div class="titlepage"><div><div><h5 class="title"><a id="usage-master-installation-dnssec"></a>3.1.3.6. Creating the initial DNSSEC keyset</h5></div></div></div>
          
          <p>If you want all zones to be signed, then after the Atomia DNS API server is installed you need to create the initial DNSSEC key set.
          In addition you will need to use a nameserver synchronization agent that supports DNSSEC; at the moment this means the PowerDNS agent.</p>
          <p>The DNSSEC setup is completed by executing the following steps:</p>
          <div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>Install the command line client:</p><div class="informalexample"><pre class="programlisting">apt-get install atomiadns-client</pre></div></li><li class="listitem"><p>Add the active key signing key:</p><div class="informalexample"><pre class="programlisting">atomiadnsclient --method AddDNSSECKey --arg RSASHA256 --arg 2048 --arg KSK --arg 1</pre></div></li><li class="listitem"><p>Add the active zone signing key:</p><div class="informalexample"><pre class="programlisting">atomiadnsclient --method AddDNSSECKey --arg RSASHA256 --arg 1024 --arg ZSK --arg 1</pre></div></li><li class="listitem"><p>Add the inactive zone signing key:</p><div class="informalexample"><pre class="programlisting">atomiadnsclient --method AddDNSSECKey --arg RSASHA256 --arg 1024 --arg ZSK --arg 0</pre></div></li></ol></div>
		  <p xmlns="" class="note">Adding DNSSEC keys on a virtual machine where you can't use keyboard input to generate entropy requires an additional step.</p>
		  <p>Install rng-tools using <code class="code">apt-get install rng-tools</code>, then open <code class="code">/etc/default/rng-tools</code> and add the following line:</p>
		  <div class="informalexample">
			<pre class="programlisting">HRNGDEVICE = /dev/urandom</pre>
		  </div>
		  <p>Now, they key creation should be instant. Note that if you do have better hardware for generating entropy, then by all means - use that instead.</p>
        </div>
      </div>
      <div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="usage-master-configuration"></a>3.1.4. Atomia DNS Master server configuration</h4></div></div></div>
        
        <p>If you use the recommended setup for the Atomia DNS Master server you don't need to edit the config file. A password is generated when creating the non-existing schema when the package is installed.</p>
        <div class="section"><div class="titlepage"><div><div><h5 class="title"><a id="usage-master-configuration-file"></a>3.1.4.1. Configuration file</h5></div></div></div>
          
          <p>
            The config file used by Atomia DNS API is placed at
            <code class="code">/etc/atomiadns.conf</code>
            and contains the following settings:
          </p>
          <table id="id1303064">
            <colgroup></colgroup>
            <thead>
              <tr>
                <td>
                  <p>Parameter</p>
                </td>
                <td>
                  <p>Example</p>
                </td>
                <td>
                  <p>Description</p>
                </td>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>
                  <p>db_name</p>
                </td>
                <td>
                  <p>zonedata</p>
                </td>
                <td>
                  <p>The name of the database.</p>
                </td>
              </tr>
              <tr>
                <td>
                  <p>db_hostname</p>
                </td>
                <td>
                  <p>localhost</p>
                </td>
                <td>
                  <p>The hostname where the database is running.</p>
                </td>
              </tr>
              <tr>
                <td>
                  <p>db_username</p>
                </td>
                <td>
                  <p>atomiadns</p>
                </td>
                <td>
                  <p>Username of the database.</p>
                </td>
              </tr>
              <tr>
                <td>
                  <p>db_password</p>
                </td>
                <td>
                  <p>password_for_the_username</p>
                </td>
                <td>
                  <p>Password for the database.</p>
                </td>
              </tr>
            </tbody>
          </table>
          <p>Default config file:</p>
          <div class="informalexample">
            <pre class="programlisting">db_name = zonedata
db_hostname = localhost
db_username = atomiadns
db_password = autogeneratedpassword
            </pre>
          </div>
        </div>
      </div>
      <div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="usage-master-updates"></a>3.1.5. Atomia DNS Master server updates</h4></div></div></div>
        
        <div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
            <p>
              <a class="link" href="usage.html#usage-master-updates-intro" title="3.1.5.1. Introduction">Introduction</a>
            </p>
          </li><li class="listitem">
            <p>
              <a class="link" href="usage.html#usage-master-updates-ubuntu" title="3.1.5.2. Updates on Ubuntu 10.04 LTS">Updates on Ubuntu 10.04 LTS</a>
            </p>
            <div class="itemizedlist"><ul class="itemizedlist" type="circle"><li class="listitem">
                <p>
                  <a class="link" href="usage.html#usage-master-updates-where" title="3.1.5.2.1. Where to get updates?">Where to get updates?</a>
                </p>
              </li></ul></div>
          </li><li class="listitem">
            <p>
              <a class="link" href="usage.html#usage-master-updates-rhel" title="3.1.5.3. Updates on Redhat Enterprise Liux">Updates on Redhat Enterprise Linux</a>
            </p>
            <div class="itemizedlist"><ul class="itemizedlist" type="circle"><li class="listitem">
                <p>
                  <a class="link" href="usage.html#usage-master-update-rhel-where" title="3.1.5.3.1. Where to get updates?">Where to get updates?</a>
                </p>
              </li></ul></div>
          </li></ul></div>
        <div class="section"><div class="titlepage"><div><div><h5 class="title"><a id="usage-master-updates-intro"></a>3.1.5.1. Introduction</h5></div></div></div>
          
          <p>Updates are done by installing the latest version of the installed packages.</p>
          <p>Any change in the dependencies will be handled appropriately by the installation package, upgrading or installing them as needed.</p>
          <p>If the database schema has changed, the schema on the Atomia DNS Master server will be automatically updated. If you have chosen to have the database on a separate server, you will have to update the atomiadns-database package on that server as well. All schema changes are noted in the release notes for the new version.</p>
        </div>
        <div class="section"><div class="titlepage"><div><div><h5 class="title"><a id="usage-master-updates-ubuntu"></a>3.1.5.2. Updates on Ubuntu 10.04 LTS</h5></div></div></div>
          
          <p>To install an update, complete the following steps:</p>
          <div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">
              <p>Update all packages:</p>
              <div class="informalexample">
                <pre class="programlisting">apt-get update</pre>
              </div>
            </li><li class="listitem">
              <p>Note the version number of the package currently installed.</p>
            </li><li class="listitem">
              <p>Install updates using:</p>
              <div class="informalexample">
                <pre class="programlisting">apt-get install atomiadns-masterserver</pre>
              </div>
            </li></ol></div>
          <p>If you for some reason want to rollback to the previous version, then run:</p>
          <div class="informalexample">
            <pre class="programlisting">apt-get install atomiadns-masterserver=version-number-noted</pre>
          </div>
          <div class="section"><div class="titlepage"><div><div><h6 class="title"><a id="usage-master-updates-where"></a>3.1.5.2.1. Where to get updates?</h6></div></div></div>
            
            <p>
              Updates are distributed using the Atomia APT repository.
		If not done, then add the Atomia APT Repository to the server using:
		</p><pre class="programlisting">wget -q -O - http://public.apt.atomia.com/setup.sh.shtml | sed s/%distcode/`lsb_release -c | awk '{ print $2 }'`/g | sh</pre><p>
            </p>
          </div>
        </div>
        <div class="section"><div class="titlepage"><div><div><h5 class="title"><a id="usage-master-updates-rhel"></a>3.1.5.3. Updates on Redhat Enterprise Liux</h5></div></div></div>
          
          <p>To install an update, complete the following steps:</p>
          <div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">
              <p>Clean the cache so that you are sure that you get the latest:</p>
              <div class="informalexample">
                <pre class="programlisting">yum clean expire-cache --disablerepo "*" --enablerepo atomia</pre>
              </div>
            </li><li class="listitem">
              <p>Upgrade the package:</p>
              <div class="informalexample">
                <pre class="programlisting">yum install atomiadns-masterserver</pre>
              </div>
            </li></ol></div>
          <div class="section"><div class="titlepage"><div><div><h6 class="title"><a id="usage-master-update-rhel-where"></a>3.1.5.3.1. Where to get updates?</h6></div></div></div>
            
            <p>
              Updates are distributed using the Atomia RPM repository.
            </p>
          </div>
        </div>
      </div>
      <div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="usage-master-usage"></a>3.1.6. Atomia DNS Master server usage</h4></div></div></div>
        
        <div class="section"><div class="titlepage"><div><div><h5 class="title"><a id="usage-master-usage-api"></a>3.1.6.1. Atomia DNS API</h5></div></div></div>
          
          <p>
            The Atomia DNS Master server is administrated using an API which you can use to create a web interface or other applications. For information on how the API works and how to use it see
            <a class="link" href="apidocs.html" title="5. Atomia DNS API">Atomia DNS API</a>
            .
          </p>
        </div>
        <div class="section"><div class="titlepage"><div><div><h5 class="title"><a id="usage-master-dyndns"></a>3.1.6.2. Atomia DNS DynDNS</h5></div></div></div>
          
          <p>
            The Atomia DNS DynDNS client is used to handle DynDNS updates according to the DNS protocol. The client acts as a regular nameserver but only has support for DynDNS updates. For information on how DynDNS works and how to use it see
            <a class="link" href="usage.html#usage-dyndns" title="3.4. Atomia DNS DynDNS">Atomia DNS DynDNS</a>
            .
          </p>
        </div>
      </div>
      <div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="usage-master-techinfo"></a>3.1.7. Master database</h4></div></div></div>
        
        <p>
          The schema for the Atomia DNS database can be found on the
          <a class="link" href="usage.html#usage-master-server" title="3.1. Atomia DNS Master server">Atomia DNS Master server</a>
          in
          <code class="code">/usr/share/atomiadns/schema</code>
          .
        </p>
        <p>It contains the following tables:</p>
        <table id="id1303635">
          <colgroup></colgroup>
          <thead>
            <tr>
              <td>
                <p>Table</p>
              </td>
              <td>
                <p>Description</p>
              </td>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>
                <p>allowed_type</p>
              </td>
              <td>
                <p>Ccontains a list of allowed DNS types together with regular expressions for validating data.</p>
              </td>
            </tr>
            <tr>
              <td>
                <p>updates_disabled</p>
              </td>
              <td>
                <p>Always contains a single row stating if updates to the nameservers are disabled or enabled.</p>
              </td>
            </tr>
            <tr>
              <td>
                <p>nameserver</p>
              </td>
              <td>
                <p>Contains one row of all nameservers subscribing to this data set.</p>
              </td>
            </tr>
            <tr>
              <td>
                <p>change</p>
              </td>
              <td>
                <p>Contains one row for every changed zone per nameserver that hasn't propagated the change yet.</p>
              </td>
            </tr>
            <tr>
              <td>
                <p>zone</p>
              </td>
              <td>
                <p>Contains the zone name and a primary key.</p>
              </td>
            </tr>
            <tr>
              <td>
                <p>label</p>
              </td>
              <td>
                <p>Contains the label name, a foreign key mapping the label to a zone and a primary key.</p>
              </td>
            </tr>
            <tr>
              <td>
                <p>record</p>
              </td>
              <td>
                <p>Contains the record data, a foreign key mapping the record to a label and a primary key.</p>
              </td>
            </tr>
          </tbody>
        </table>
        <p>
          It also contains a number of triggers for validating data and one stored procedure for every method in the
          <a class="link" href="apidocs.html" title="5. Atomia DNS API">Atomia DNS API</a>
          .
        </p>
      </div>
    </div>
    <div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="usage-bind-dlz"></a>3.2. Atomia DNS Bind-DLZ Nameserver</h3></div></div></div>
      
      <div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="usage-bind-dlz-whatis"></a>3.2.1. What is the Atomia DNS Bind-DLZ Nameserver?</h4></div></div></div>
        
        <p xmlns="" class="note">We no longer recommend the Bind-DLZ sync agent, the PowerDNS integration is more actively developed and is a requirement for DNSSEC support</p>
        <p>The nameserver includes the popular BIND nameserver configured to use a local database instead of zone files. All nameservers will also have the Atomia DNS Sync application installed which provisions changes to the local database and also settings for BIND from the data in the Atomia DNS database.</p>
      </div>
      <div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="usage-bind-dlz-docs"></a>3.2.2. Atomia DNS Bind-DLZ Nameserver documentation</h4></div></div></div>
        
        <p>Please locate the desired information in one of the following sections:</p>
        <div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
            <p>
              <a class="link" href="usage.html#usage-bind-dlz-installation" title="3.2.3. Atomia DNS Bind-DLZ Nameserver installation">Atomia DNS Bind-DLZ Nameserver installation</a>
            </p>
          </li><li class="listitem">
            <p>
              <a class="link" href="usage.html#usage-bind-dlz-configuration" title="3.2.4. Atomia DNS Bind-DLZ Nameserver configuration">Atomia DNS Bind-DLZ Nameserver configuration</a>
            </p>
          </li><li class="listitem">
            <p>
              <a class="link" href="usage.html#usage-bind-dlz-updates" title="3.2.5. Atomia DNS Bind-DLZ Nameserver updates">Atomia DNS Bind-DLZ Nameserver updates</a>
            </p>
          </li><li class="listitem">
            <p>
              <a class="link" href="usage.html#usage-bind-dlz-usage" title="3.2.6. Atomia DNS Bind-DLZ Nameserver usage">Atomia DNS Bind-DLZ Nameserver usage</a>
            </p>
          </li><li class="listitem">
            <p>
              <a class="link" href="usage.html#usage-bind-dlz-techinfo" title="3.2.7. BDB databases on the nameservers">Atomia DNS Bind-DLZ Nameserver technical information</a>
            </p>
          </li></ul></div>
      </div>
      <div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="usage-bind-dlz-installation"></a>3.2.3. Atomia DNS Bind-DLZ Nameserver installation</h4></div></div></div>
        
        <div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
            <p>
              <a class="link" href="usage.html#usage-bind-dlz-installation-intro" title="3.2.3.1. Introduction">Introduction</a>
            </p>
          </li><li class="listitem">
            <p>
              <a class="link" href="usage.html#usage-bind-dlz-installation-ubuntu" title="3.2.3.2. Installation on Ubuntu LTS">Installation on Ubuntu LTS</a>
            </p>
          </li><li class="listitem">
            <p>
              <a class="link" href="usage.html#usage-bind-dlz-installation-rhel4" title="3.2.3.3. Installation on Redhat Enterprise Linux 4">Installation on Redhat Enterprise Linux 4</a>
            </p>
          </li><li class="listitem">
            <p>
              <a class="link" href="usage.html#usage-bind-dlz-installation-software" title="3.2.3.4. Software used by Atomia DNS Bind-DLZ Nameserver">Software used by Atomia DNS Bind-DLZ Nameserver</a>
            </p>
          </li><li class="listitem">
            <p>
              <a class="link" href="usage.html#usage-bind-dlz-installation-troubleshoot" title="3.2.3.5. Installation troubleshooting">Installation troubleshooting</a>
            </p>
          </li></ul></div>
        <div class="section"><div class="titlepage"><div><div><h5 class="title"><a id="usage-bind-dlz-installation-intro"></a>3.2.3.1. Introduction</h5></div></div></div>
          
          <p>This guide will install the Atomia DNS Bind-DLZ Nameserver.</p>
        </div>
        <div class="section"><div class="titlepage"><div><div><h5 class="title"><a id="usage-bind-dlz-installation-ubuntu"></a>3.2.3.2. Installation on Ubuntu LTS</h5></div></div></div>
          
          <div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">
              <p>Install the latest Ubuntu LTS relase.</p>
            </li><li class="listitem">
              <p>
                  	Add the Atomia APT Repository to the server using:
	                </p><pre class="programlisting">wget -q -O - http://public.apt.atomia.com/setup.sh.shtml | sed s/%distcode/`lsb_release -c | awk '{ print $2 }'`/g | sh</pre><p>
              </p>
            </li><li class="listitem">
              <p>Install the Bind-DLZ package we provide:</p>
              <div class="informalexample">
                <pre class="programlisting">apt-get install bind9-dlz-bdbhpt</pre>
              </div>
            </li><li class="listitem">
              <p>Install the Atomia DNS Bind-DLZ Nameserver:</p>
              <div class="informalexample">
                <pre class="programlisting">apt-get install atomiadns-nameserver</pre>
              </div>
            </li><li class="listitem">
              <p>Install the Atomia DNS Client utility:</p>
              <div class="informalexample">
                <pre class="programlisting">apt-get install atomiadns-client</pre>
              </div>
            </li><li class="listitem">
              <p>Edit the configuration file:</p>
              <div class="informalexample">
                <pre class="programlisting">edit /etc/atomiadns.conf</pre>
              </div>
              <div class="orderedlist"><ol class="orderedlist" type="a"><li class="listitem">
                  <p>Change the soap_uri row to contain the hostname of your Atomia DNS Master server</p>
                </li><li class="listitem">
                  <p>Add a row looking like 'server_name = hostname of this node'</p>
                </li><li class="listitem">
                  <p>Example configuration:</p>
                  <div class="informalexample">
                    <pre class="programlisting">servername = your.name.server
soap_uri = https://your.atomia.dns.master.server.com/atomiadns
soap_cacert = /etc/atomiadns_soap_cert.crt
soap_username = atomia
soap_password = XXXXXX
bdb_environment_path = /var/lib/bind/atomiadns_bdb
bdb_filename = dns_data.db
rndc_path = /usr/sbin/rndc
slavezones_config = /etc/bind/slave/named-slavezones.conf.local
slavezones_dir = /etc/bind/slave/zones
                    </pre>
                  </div>
                </li></ol></div>
            </li><li class="listitem">
              <p>If this is the first server in it's nameserver group, then add the group (substitute groupname):</p>
              <div class="informalexample">
                <pre class="programlisting">atomiadnsclient --method AddNameserverGroup --arg groupname</pre>
              </div>
            </li><li class="listitem">
              <p>Add the nameserver as a subscriber of the zones in the configured Atomia DNS Master server (substitute groupname):</p>
              <div class="informalexample">
                <pre class="programlisting">atomiadnssync add_server groupname</pre>
              </div>
            </li><li class="listitem">
              <p>Start the daemon that fetches updates and replicates those to the local zone database:</p>
              <div class="informalexample">
                <pre class="programlisting">/etc/init.d/atomiadns-nameserver start</pre>
              </div>
            </li><li class="listitem">
              <p>Initiate a full reload of all zones in the Atomia DNS Master sever (all nameservers are reloaded):</p>
              <div class="informalexample">
                <pre class="programlisting">atomiadnssync full_reload_online</pre>
              </div>
            </li><li class="listitem">
              <p>Start BIND:</p>
              <div class="informalexample">
                <pre class="programlisting">/etc/init.d/bind9-dlz-bdbhpt start</pre>
              </div>
            </li></ol></div>
        </div>
        <div class="section"><div class="titlepage"><div><div><h5 class="title"><a id="usage-bind-dlz-installation-rhel4"></a>3.2.3.3. Installation on Redhat Enterprise Linux 4</h5></div></div></div>
          
          <div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">
              <p>First setup GPG-keys for the needed repositories.</p>
              <div class="informalexample">
				<pre class="programlisting">rpm -Uhv http://apt.sw.be/redhat/el4/en/i386/rpmforge/RPMS/rpmforge-release-0.3.6-1.el4.rf.i386.rpm
rpm -Uhv http://rpm.atomia.com/rhel4/atomia-repository-setup-1.0-1.noarch.rpm
                </pre>
              </div>
            </li><li class="listitem">
              <p>Then configure up2date to use them, by adding to /etc/sysconfig/rhn/sources:</p>
              <div class="informalexample">
                <pre class="programlisting">yum atomia http://rpm.atomia.com/rhel4
yum dag http://apt.sw.be/redhat/el4/en/$ARCH/dag
                </pre>
              </div>
            </li><li class="listitem">
              <p>Install the Atomia DNS master server:</p>
              <div class="informalexample">
                <pre class="programlisting">up2date -i atomiadns-nameserver</pre>
              </div>
            </li><li class="listitem">
              <p>Install the Atomia DNS Client utility:</p>
              <div class="informalexample">
                <pre class="programlisting">up2date -i atomiadns-client</pre>
              </div>
            </li><li class="listitem">
              <p>Edit the configuration file:</p>
              <div class="informalexample">
                <pre class="programlisting">edit /etc/atomiadns.conf</pre>
              </div>
              <div class="orderedlist"><ol class="orderedlist" type="a"><li class="listitem">
                  <p>Change the soap_uri row to contain the hostname of your Atomia DNS Master server</p>
                </li><li class="listitem">
                  <p>Add a row looking like 'server_name = hostname of this node'</p>
                </li><li class="listitem">
                  <p>Example configuration:</p>
                  <div class="informalexample">
                    <pre class="programlisting">servername = your.name.server
soap_uri = https://your.atomia.dns.master.server.com/atomiadns
soap_cacert = /etc/atomiadns_soap_cert.crt
soap_username = atomia
soap_password = XXXXXX
bdb_environment_path = /var/lib/bind/atomiadns_bdb
bdb_filename = dns_data.db
rndc_path = /usr/sbin/rndc
slavezones_config = /etc/bind/slave/named-slavezones.conf.local
slavezones_dir = /etc/bind/slave/zones
                    </pre>
                  </div>
                </li></ol></div>
            </li><li class="listitem">
              <p>If this is the first server in it's nameserver group, then add the group (substitute groupname):</p>
              <div class="informalexample">
                <pre class="programlisting">atomiadnsclient --method AddNameserverGroup --arg groupname</pre>
              </div>
            </li><li class="listitem">
              <p>Add the nameserver as a subscriber of the zones in the configured Atomia DNS Master server (substitute groupname):</p>
              <div class="informalexample">
                <pre class="programlisting">atomiadnssync add_server groupname</pre>
              </div>
            </li><li class="listitem">
              <p>Start the daemon that fetches updates and replicates those to the local zone database:</p>
              <div class="informalexample">
                <pre class="programlisting">service atomiadnssync start</pre>
              </div>
            </li><li class="listitem">
              <p>Initiate a full reload of all zones in the Atomia DNS Master sever (all nameservers are reloaded):</p>
              <div class="informalexample">
                <pre class="programlisting">atomiadnssync full_reload_online</pre>
              </div>
            </li><li class="listitem">
              <p>Start BIND:</p>
              <div class="informalexample">
                <pre class="programlisting">service bind start</pre>
              </div>
            </li></ol></div>
        </div>
        <div class="section"><div class="titlepage"><div><div><h5 class="title"><a id="usage-bind-dlz-installation-software"></a>3.2.3.4. Software used by Atomia DNS Bind-DLZ Nameserver</h5></div></div></div>
          
          <p>On the nameservers the following software is needed:</p>
          <div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
              <p>
                <span class="italics">Config::General</span>
              </p>
            </li><li class="listitem">
              <p>
                <span class="italics">SOAP::Lite</span>
              </p>
            </li><li class="listitem">
              <p>
                <span class="italics">Moose</span>
              </p>
            </li><li class="listitem">
              <p>
                <span class="italics">BerkeleyDB</span>
              </p>
            </li><li class="listitem">
              <p>
                <span class="italics">Bind9 compiled with DLZ and the bdbhpt driver linked to the same bdb-version as the BerkeleyDB module</span>
              </p>
            </li></ul></div>
          <p>
            All needed software, including prerequisites are installed by the provided package,
            <span class="italics">atomiadns-nameserver</span>
            .
          </p>
        </div>
        <div class="section"><div class="titlepage"><div><div><h5 class="title"><a id="usage-bind-dlz-installation-troubleshoot"></a>3.2.3.5. Installation troubleshooting</h5></div></div></div>
          
        </div>
      </div>
      <div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="usage-bind-dlz-configuration"></a>3.2.4. Atomia DNS Bind-DLZ Nameserver configuration</h4></div></div></div>
        
        <p>You have to configure the Atomia DNS Bind-DLZ Nameserver to fit your environment.</p>
        <div class="section"><div class="titlepage"><div><div><h5 class="title"><a id="usage-bind-dlz-configuration-file"></a>3.2.4.1. Configuration file</h5></div></div></div>
          
          <p>
            The config file used by Atomia DNS Bind-DLZ Nameserver is placed in
            <code class="code">/etc/atomiadns.conf</code>
            and contains the following settings:
          </p>
          <table id="id1304665">
            <colgroup></colgroup>
            <thead>
              <tr>
                <td>
                  <p>Parameter</p>
                </td>
                <td>
                  <p>Example</p>
                </td>
                <td>
                  <p>Description</p>
                </td>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>
                  <p>bdb_environment_path</p>
                </td>
                <td>
                  <p>/var/lib/bind/atomiadns_bdb</p>
                </td>
                <td>
                  <p>Path where the database should be stored.</p>
                </td>
              </tr>
              <tr>
                <td>
                  <p>soap_uri</p>
                </td>
                <td>
                  <p>
                    <a class="ulink" href="http://hostname.of.your.soap.server/atomiadns" target="_top">http://hostname.of.your.soap.server/atomiadns</a>
                  </p>
                </td>
                <td>
                  <p>URI of the Atomia DNS API.</p>
                </td>
              </tr>
              <tr>
                <td>
                  <p>bdb_filename</p>
                </td>
                <td>
                  <p>dns_data.db</p>
                </td>
                <td>
                  <p>Filename of the database.</p>
                </td>
              </tr>
              <tr>
                <td>
                  <p>servername</p>
                </td>
                <td>
                  <p>ns1.yourhost.com</p>
                </td>
                <td>
                  <p>Hostname of the nameserver.</p>
                </td>
              </tr>
            </tbody>
          </table>
          <p>soap_uri and servername always needs to be changed. For the other two parameters, the default settings will work.</p>
          <p>Default config file:</p>
          <div class="informalexample">
            <pre class="programlisting">bdb_environment_path = /var/lib/bind/atomiadns_bdb
soap_uri = http://your.atomia.dns.master.server.com/atomiadns
bdb_filename = dns_data.db
servername = your.name.server
slavezones_config = /etc/bind/slave/named-slavezones.conf.local
slavezones_dir = /etc/bind/slave/zones
            </pre>
          </div>
        </div>
        <div class="section"><div class="titlepage"><div><div><h5 class="title"><a id="usage-bind-dlz-scripts"></a>3.2.4.2. Scripts and commands</h5></div></div></div>
          
          <p>
            For more information on how to use the Atomia DNS Sync application see
            <a class="link" href="usage.html#usage-bind-dlz-usage" title="3.2.6. Atomia DNS Bind-DLZ Nameserver usage">Atomia DNS Bind-DLZ Nameserver usage</a>
            .
          </p>
        </div>
      </div>
      <div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="usage-bind-dlz-updates"></a>3.2.5. Atomia DNS Bind-DLZ Nameserver updates</h4></div></div></div>
        
        <p>To install an update, complete the following steps:</p>
        <div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">
            <p>Update all packages:</p>
            <div class="informalexample">
              <pre class="programlisting">apt-get update</pre>
            </div>
          </li><li class="listitem">
            <p>Note the version number of the package currently installed.</p>
          </li><li class="listitem">
            <p>Install updates using:</p>
            <div class="informalexample">
              <pre class="programlisting">apt-get install atomiadns-nameserver
/etc/init.d/atomiadns-nameserver restart
              </pre>
            </div>
          </li></ol></div>
        <p>If you for some reason want to rollback to the previous version, then run:</p>
        <div class="informalexample">
          <pre class="programlisting">apt-get install atomiadns-nameserver=version-number-noted</pre>
        </div>
        <p>Any changes in the dependencies will be handled appropriately by the installation package, upgrading or installing them as needed.</p>
        <div class="section"><div class="titlepage"><div><div><h5 class="title"><a id="usage-bind-dlz-updates-where"></a>3.2.5.1. Where to get updates?</h5></div></div></div>
          
          <p>
              Updates are distributed using the Atomia APT repository.
		If not done, then add the Atomia APT Repository to the server using:
		</p><pre class="programlisting">wget -q -O - http://public.apt.atomia.com/setup.sh.shtml | sed s/%distcode/`lsb_release -c | awk '{ print $2 }'`/g | sh</pre><p>
          </p>
        </div>
        <div class="section"><div class="titlepage"><div><div><h5 class="title"><a id="usage-bind-dlz-updates-building-rpms"></a>3.2.5.2. Atomia DNS Building new Bind-DLZ RPMS</h5></div></div></div>
          
          <div class="section"><div class="titlepage"><div><div><h6 class="title"><a id="usage-bind-dlz-updates-building-rpms-instructions"></a>3.2.5.2.1. Instructions</h6></div></div></div>
            
            <p>To build new RPMS for Bind-DLZ whenever an important new release is made we use the following steps:</p>
            <div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">
                <p>Login to build machine for the OS release in question (e.g. RHEL5, RHEL4 etc).</p>
              </li><li class="listitem">
                <p>
                  Download
                  <a class="ulink" href="https://raw.github.com/atomia/atomiadns/develop/syncer/bind9_rhel5_rpm.patch" target="_top">bind9_rhel5_rpm.patch</a>
                  and place it in /usr/src/redhat
                </p>
              </li><li class="listitem">
                <p>Checkout redhat package sources:</p>
                <div class="informalexample">
                  <pre class="programlisting">cvs -d ":pserver:anonymous@cvs.fedoraproject.org:/cvs/pkgs" co rpms/bind</pre>
                </div>
              </li><li class="listitem">
                <p>Use the latest non-devel version of the spec:</p>
                <div class="informalexample">
                  <pre class="programlisting">cd rpms/bind/F-12</pre>
                </div>
              </li><li class="listitem">
                <p>Patch the package sources to include the things we need:</p>
                <div class="informalexample">
                  <pre class="programlisting">patch -p1 &lt; /usr/src/redhat/bind9_rhel_rpm.atomia.patch</pre>
                </div>
              </li><li class="listitem">
                <p>Build the SRPM:</p>
                <div class="informalexample">
                  <pre class="programlisting">rm *rpm ; make srpm</pre>
                </div>
              </li><li class="listitem">
                <p>Install the sources and SPEC-file:</p>
                <div class="informalexample">
                  <pre class="programlisting">rpm -i *rpm</pre>
                </div>
              </li><li class="listitem">
                <p>Build it:</p>
                <div class="informalexample">
                  <pre class="programlisting">cd /usr/src/redhat/SPECS &amp;&amp; rpmbuild -bb --sign bind.spec</pre>
                </div>
              </li></ol></div>
          </div>
        </div>
      </div>
      <div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="usage-bind-dlz-usage"></a>3.2.6. Atomia DNS Bind-DLZ Nameserver usage</h4></div></div></div>
        
        <div class="section"><div class="titlepage"><div><div><h5 class="title"><a id="usage-bind-dlz-usage-syncapp"></a>3.2.6.1. Sync application</h5></div></div></div>
          
          <p>
            The sync application is called atomiadnssync. You can view its manual page
            <a class="link" href="usage.html#usage-bind-dlz-usage-syncer-man" title="3.2.6.2. Atomia DNS Sync manual">here</a>
            or by running:
          </p>
          <div class="informalexample">
            <pre class="programlisting">man atomiadnssync</pre>
          </div>
        </div>
        <div class="section"><div class="titlepage"><div><div><h5 class="title"><a id="usage-bind-dlz-usage-syncer-man"></a>3.2.6.2. Atomia DNS Sync manual</h5></div></div></div>
          
          <div class="section"><div class="titlepage"><div><div><h6 class="title"><a id="usage-bind-dlz-usage-syncer-man-name"></a>3.2.6.2.1. NAME</h6></div></div></div>
            
            <p>atomiadnssync - An application for synchronizing a local BDB database with the master zone database using SOAP.</p>
          </div>
          <div class="section"><div class="titlepage"><div><div><h6 class="title"><a id="usage-bind-dlz-usage-syncer-man-synopsis"></a>3.2.6.2.2. SYNOPSIS</h6></div></div></div>
            
            <pre class="programlisting">atomiadnssync full_reload_offline SERIAL DESTINATION
atomiadnssync OPTION
            </pre>
          </div>
          <div class="section"><div class="titlepage"><div><div><h6 class="title"><a id="usage-bind-dlz-usage-syncer-man-description"></a>3.2.6.2.3. DESCRIPTION</h6></div></div></div>
            
            <p>atomiadnssync is an application for synchronizing a local BDB database with the master zone database using SOAP.</p>
            <p>It contains options for both doing a full reload of all zones in the master database, and for just fetching the zones changed since the last update and reloading those.</p>
            <p>In addition you can use this tool for adding or removing the subscription of updates for a nameserver, and for enabling and disabling propagation of updates globally across all nameservers.</p>
          </div>
          <div class="section"><div class="titlepage"><div><div><h6 class="title"><a id="usage-bind-dlz-usage-syncer-man-options"></a>3.2.6.2.4. OPTIONS</h6></div></div></div>
            
            <p>
              <code class="code">full_reload_offline SERIAL DESTINATION</code>
            </p>
            <div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
                <p>Propagates all zones to a fresh BDB environment stored in the destination folder (should be empty before running). All zones get the serial specified in their SOA-record. This command should always be run with the same user BIND is running as.</p>
              </li></ul></div>
            <p>
              <code class="code">full_reload_online</code>
            </p>
            <div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
                <p>Marks all zones as changed so that the update-process propagates them on all nameservers.</p>
              </li></ul></div>
            <p>
              <code class="code">full_reload_slavezones</code>
            </p>
            <div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
                <p>Marks all slave zones as changed so that the update-process propagates them on all nameservers.</p>
              </li></ul></div>
            <p>
              <code class="code">updated</code>
            </p>
            <div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
                <p>Fetches a list of changed zones and adds/removes them from the local BDB database. This option is used by the daemon started at boot-time by /etc/init.d/atomiadns-nameserver. You should never run this manually.</p>
              </li></ul></div>
            <p>
              <code class="code">add_server</code>
            </p>
            <div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
                <p>Adds this server (configured using servername in /etc/atomiadns.conf) as a subscriber of the data set on the configured SOAP server.</p>
              </li></ul></div>
            <p>
              <code class="code">remove_server</code>
            </p>
            <div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
                <p>Remove the subscription of the data set on the configured SOAP server for this server (configured using servername in /etc/atomiadns.conf).</p>
              </li></ul></div>
            <p>
              <code class="code">disable_updates</code>
            </p>
            <div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
                <p>Disable propagation of changes to the nameservers.</p>
              </li></ul></div>
            <p>
              <code class="code">enable_updates</code>
            </p>
            <div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
                <p>Enable propagation of changes to the nameservers</p>
              </li></ul></div>
          </div>
          <div class="section"><div class="titlepage"><div><div><h6 class="title"><a id="usage-bind-dlz-usage-syncer-man-configuration"></a>3.2.6.2.5. CONFIGURATION</h6></div></div></div>
            
            <p>The application is configured using a config file stored at /etc/atomiadns.conf. All options are required.</p>
            <p>The following options exist:</p>
            <p>
              <code class="code">bdb_environment_path</code>
            </p>
            <div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
                <p>Specifies the path of the local BDB environment. The default is /var/lib/bind/atomiadns_bdb, and does probably not need to change.</p>
              </li></ul></div>
            <p>
              <code class="code">bdb_filename</code>
            </p>
            <div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
                <p>Specifies the filename (relative to bdb_environment_path) of the local BDB database. The default is dns_data.db, and does probably not need to change.</p>
              </li></ul></div>
            <p>
              <code class="code">soap_uri</code>
            </p>
            <div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
                <p>Specifies the URI of the SOAP Server to fetch changes from.</p>
              </li></ul></div>
            <p>
              <code class="code">servername</code>
            </p>
            <div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
                <p>Specifies the filename which contain a list of the configured slave zones.</p>
              </li></ul></div>
            <p>
              <code class="code">slavezones_config</code>
            </p>
            <div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
                <p>Specifies the hostname used when subscribing and checking for changes.</p>
              </li></ul></div>
            <p>
              <code class="code">slavezones_dir</code>
            </p>
            <div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
                <p>Specifies the directory where zone files for the slave zones are stored.</p>
              </li></ul></div>
          </div>
          <div class="section"><div class="titlepage"><div><div><h6 class="title"><a id="usage-bind-dlz-usage-syncer-man-examples"></a>3.2.6.2.6. EXAMPLES</h6></div></div></div>
            
            <p>To do a full reload to a new folder without missing any updates (assuming the default bdb_environment_path), do:</p>
            <p>1. atomiadnssync disable_updates</p>
            <p>2. Verify manually that no pending changes exist.</p>
            <p>3. Write down the output (unix timestamp) of `date +%s`</p>
            <p>4. Run `atomiadnssync full_reload_offline the_timestamp /var/lib/bind/atomiadns_bdb_new</p>
            <p>5. rm -rf /var/lib/bind/atomiadns_bdb_old ; mv /var/lib/bind/atomiadns_bdb /var/lib/bind/atomiadns_bdb_old ; mv /var/lib/bind/atomiadns_bdb_new /var/lib/bind/atomiadns_bdb</p>
            <p>6. rndc reload</p>
            <p>7. atomiadnssync enable_updates</p>
            <p>Or to accomplish the same thing using the online reload feature (much better and the preferred way):</p>
            <p>atomiadnssync full_reload_online</p>
            <p>To add the server as a subscriber:</p>
            <p>atomiadnssync add_server</p>
          </div>
          <div class="section"><div class="titlepage"><div><div><h6 class="title"><a id="usage-bind-dlz-usage-syncer-man-author"></a>3.2.6.2.7. AUTHOR</h6></div></div></div>
            
            <p>Atomia DNS was developed by Atomia AB. For support, please see <a class="ulink" href="http://www.atomiadns.com/" target="_top">http://www.atomiadns.com/</a>.</p>
          </div>
        </div>
      </div>
      <div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="usage-bind-dlz-techinfo"></a>3.2.7. BDB databases on the nameservers</h4></div></div></div>
        
        <p>
          On the nameservers the location of the BDB databases is configured in
          <code class="code">/etc/atomiadns</code>
          using
          <code class="code">bdb_environment_path</code>
          and
          <code class="code">bdb_filename</code>
          .
        </p>
        <p>You can use the regular BDB utilities to do things like hot backup and crash recovery.</p>
        <p>
          More information can be found in the BDB documentation, for example:
          
          <a class="ulink" href="http://www.oracle.com/technology/documentation/berkeley-db/db/ref/transapp/archival.html" target="_top">http://www.oracle.com/technology/documentation/berkeley-db/db/ref/transapp/archival.html</a>
          
          <a class="ulink" href="http://www.oracle.com/technology/documentation/berkeley-db/db/ref/transapp/recovery.html" target="_top">http://www.oracle.com/technology/documentation/berkeley-db/db/ref/transapp/recovery.html</a>
        </p>
        <p>
          If the BDB databases were to become corrupt, the recommended solution would be to do a full resync of the BDB databases from the master. This is done using the
          <a class="link" href="usage.html#usage-bind-dlz-usage-syncapp" title="3.2.6.1. Sync application">atomiadnssync tool</a>
          .
        </p>
      </div>
    </div>
    <div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="usage-powerdns"></a>3.3. Atomia DNS PowerDNS Nameserver</h3></div></div></div>
      
      <div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="usage-powerdns-whatis"></a>3.3.1. What is the Atomia DNS PowerDNS Nameserver?</h4></div></div></div>
        
        <p>The nameserver includes the popular PowerDNS nameserver configured to use a local MySQL database instead of zone files. All PowerDNS nameservers will also have the Atomia DNS PowerDNS Sync application installed which provisions changes to the local database from the data in the Atomia DNS database.</p>
      </div>
      <div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="usage-powerdns-docs"></a>3.3.2. Atomia DNS PowerDNS Nameserver documentation</h4></div></div></div>
        
        <p>Please locate the desired information in one of the following sections:</p>
        <div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
            <p>
              <a class="link" href="usage.html#usage-powerdns-installation" title="3.3.3. Atomia DNS PowerDNS Nameserver installation">Atomia DNS PowerDNS Nameserver installation</a>
            </p>
          </li></ul></div>
      </div>
      <div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="usage-powerdns-installation"></a>3.3.3. Atomia DNS PowerDNS Nameserver installation</h4></div></div></div>
        
        <div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
            <p>
              <a class="link" href="usage.html#usage-powerdns-installation-intro" title="3.3.3.1. Introduction">Introduction</a>
            </p>
          </li><li class="listitem">
            <p>
              <a class="link" href="usage.html#usage-powerdns-installation-ubuntu" title="3.3.3.2. Installation on Ubuntu LTS">Installation on Ubuntu LTS</a>
            </p>
          </li><li class="listitem">
            <p>
              <a class="link" href="usage.html#usage-powerdns-installation-freebsd" title="3.3.3.3. Installation on FreeBSD">Installation on FreeBSD</a>
            </p>
          </li><li class="listitem">
            <p>
              <a class="link" href="usage.html#usage-powerdns-installation-software" title="3.3.3.4. Software used by Atomia DNS Bind-DLZ Nameserver">Software used by Atomia DNS Bind-DLZ Nameserver</a>
            </p>
          </li></ul></div>
        <div class="section"><div class="titlepage"><div><div><h5 class="title"><a id="usage-powerdns-installation-intro"></a>3.3.3.1. Introduction</h5></div></div></div>
          
          <p>This guide will install the Atomia DNS Bind-DLZ Nameserver.</p>
        </div>
        <div class="section"><div class="titlepage"><div><div><h5 class="title"><a id="usage-powerdns-installation-ubuntu"></a>3.3.3.2. Installation on Ubuntu LTS</h5></div></div></div>
          
          <div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">
              <p>Install the latest Ubuntu LTS relase.</p>
            </li><li class="listitem">
              <p>
                  	Add the Atomia APT Repository to the server using:
	                </p><pre class="programlisting">wget -q -O - http://public.apt.atomia.com/setup.sh.shtml | sed s/%distcode/`lsb_release -c | awk '{ print $2 }'`/g | sh</pre><p>
              </p>
            </li><li class="listitem">
              <p>Install the database schema (will also install MySQL):</p>
              <div class="informalexample">
                <pre class="programlisting">apt-get install atomiadns-powerdns-database</pre>
              </div>
            </li><li class="listitem">
              <p>To configure the nameserver to get zones from your Atomia DNS installation, add soap_uri, soap_cacert, soap_username and soap_password to /etc/atomiadns.conf</p>
              <div class="informalexample">
                <pre class="programlisting">soap_uri = https://some.server.example.com/atomiadns
soap_cacert = /path/to/CA_cert_that_signed_SSL_cert
soap_username = someuser
soap_password = somepass
                </pre>
              </div>
            </li><li class="listitem">
              <p>Also to /etc/atomiadns.conf add the subscriber name for this nameserver:</p>
              <div class="informalexample">
                <pre class="programlisting">servername = powerdns1</pre>
              </div>
            </li><li class="listitem">
              <p>Install the PowerDNS sync agent:</p>
              <div class="informalexample">
                <pre class="programlisting">apt-get install atomiadns-powerdnssync</pre>
              </div>
            </li><li class="listitem">
              <p>Add the nameserver as subscriber of the zones (replace default with whatever server group it is to be member of):</p>
              <div class="informalexample">
                <pre class="programlisting">atomiapowerdnssync add_server default</pre>
              </div>
            </li><li class="listitem">
              <p>Start the daemon:</p>
              <div class="informalexample">
                <pre class="programlisting">start atomiadns-powerdnssync</pre>
              </div>
            </li><li class="listitem">
              <p>Sync all zones:</p>
              <div class="informalexample">
                <pre class="programlisting">atomiapowerdnssync full_reload_online</pre>
              </div>
            </li><li class="listitem">
              <p>
                Go to
                <a class="ulink" href="http://powerdnssec.org/downloads/packages/" target="_top">http://powerdnssec.org/downloads/packages/</a>
                and download the latest .deb package
              </p>
            </li><li class="listitem">
              <p>Install it using (replace filename):</p>
              <div class="informalexample">
                <pre class="programlisting">dpkg -i pdns-static_3.0-rc1-1_amd64.deb</pre>
              </div>
              <div class="orderedlist"><ol class="orderedlist" type="a"><li class="listitem">
                  <p>When it asks if you want to replace /etc/powerdns/pdns.conf, just press enter to keep the version that atomiadns-powerdns-database preconfigured for you.</p>
                </li></ol></div>
            </li></ol></div>
        </div>
        <div class="section"><div class="titlepage"><div><div><h5 class="title"><a id="usage-powerdns-installation-freebsd"></a>3.3.3.3. Installation on FreeBSD</h5></div></div></div>
            
            <div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">
                <p>
                  Do a standard installation of FreeBSD. The instructions where tested with FreeBSD 9.0-RELEASE, but should work on
                  other versions as well.
                </p>
              </li><li class="listitem">
                <p>
                  Make sure you have an up-to-date ports collection, as described in
                  <a class="ulink" href="http://www.freebsd.org/doc/en_US.ISO8859-1/books/handbook/updating-upgrading-portsnap.html" target="_top">the FreeBSD handbook</a>.
                </p>
              </li><li class="listitem">
                <p>
		  </p><p xmlns="" class="note">This step is only neccessary as long as the Atomia DNS ports are not in the main ports collection</p><p>
		  </p><div class="informalexample">
		  	<pre class="programlisting">cd /usr/ports/dns ; fetch -q -o - https://github.com/atomia/atomiadns/tarball/develop | tar xvfpz - --strip-components 2 "*/freebsd"</pre>
		  </div><p>
                </p>
              </li><li class="listitem">
                <p>Install MySQL and create the database:</p>
                <div class="informalexample">
                  <pre class="programlisting">
			cd /usr/ports/databases/mysql55-server
			make BATCH=yes all install
			echo 'mysql_enable="YES"' &gt;&gt; /etc/rc.conf
			/usr/local/etc/rc.d/mysql-server start
			mysql -u root mysql -e "drop database test; delete from db; delete from user where user = ''; delete from user where host &lt;&lt; 'localhost'; flush privileges"
			mysqladmin create powerdns
			set powerdns_pw=`sh -c 'dd if=/dev/urandom bs=1024 count=1 2&gt; /dev/null | sha1'`
			mysql -u root -e "grant all on powerdns.* to 'powerdns'@'localhost' identified by '$powerdns_pw'"
			cat &gt; /root/pdns.conf.tmp &lt;&lt;EOF
			launch=gmysql
			gmysql-host=localhost
			gmysql-user=powerdns
			gmysql-dbname=powerdns
			gmysql-password=$powerdns_pw
			gmysql-dnssec=yes
			EOF
                 </pre>
                </div>
              </li><li class="listitem">
                <p>Install PowerDNS:</p>
                <div class="informalexample">
                  <pre class="programlisting">
			cd /usr/ports/dns/powerdns
			make BATCH=yes MYSQL=on PGSQL=off all install
			echo 'pdns_enable="YES"' &gt;&gt; /etc/rc.conf
			echo 'pdns_flags="--daemon --guardian=yes"' &gt;&gt; /etc/rc.conf
			mv /root/pdns.conf.tmp /usr/local/etc/pdns/pdns.conf
                 </pre>
                </div>
              </li><li class="listitem">
                <p>Install atomiadns-powerdnssync:</p>
                <div class="informalexample">
                  <pre class="programlisting">
			cd /usr/ports/atomiadns-powerdnssync
			make BATCH=yes all install
			atomiadns-sync-powerdns-database /usr/local/etc/pdns/pdns.conf
			echo "servername = $(hostname)" &gt;&gt; /etc/atomiadns.conf
			atomiapowerdnssync add_server
			echo 'atomiapowerdnssync_enable="YES"' &gt;&gt; /etc/rc.conf
			/usr/local/etc/rc.d/atomiapowerdnssync start
			atomiapowerdnssync full_reload_online
                 </pre>
                </div>
              </li><li class="listitem">
                <p>Start PowerDNS:</p>
                <div class="informalexample">
                  <pre class="programlisting">
                  	/usr/local/etc/rc.d/pdns start
                 </pre>
                </div>
              </li></ol></div>
        </div>
        <div class="section"><div class="titlepage"><div><div><h5 class="title"><a id="usage-powerdns-installation-software"></a>3.3.3.4. Software used by Atomia DNS Bind-DLZ Nameserver</h5></div></div></div>
          
          <p>On the nameservers the following software is needed:</p>
          <div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
              <p>PowerDNS</p>
            </li><li class="listitem">
              <p>MySQL</p>
            </li><li class="listitem">
              <p>Atomia DNS PowerDNS sync</p>
            </li></ul></div>
        </div>
      </div>
    </div>
    <div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="usage-dyndns"></a>3.4. Atomia DNS DynDNS</h3></div></div></div>
      
      <div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="usage-dyndns-whatis"></a>3.4.1. What is the Atomia DNS DynDNS server?</h4></div></div></div>
        
        <p>Atomia DNS DynDNS provides a DynDNS server supporting standard DNS update requests, performing the updates using an Atomia DNS Master server installation.</p>
        <p>When using Atomia DNS DynDNS any standard DynDNS client can be used. Examples include:</p>
        <div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">
            <p>nsupdate</p>
          </li><li class="listitem">
            <p>dhcpd</p>
          </li><li class="listitem">
            <p>Windows DHCP client service</p>
          </li></ol></div>
      </div>
      <div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="usage-dyndns-docs"></a>3.4.2. Atomia DNS DynDNS server documentation</h4></div></div></div>
        
        <p>Please locate the desired information in one of the following sections:</p>
        <div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
            <p>
              <a class="link" href="usage.html#usage-dyndns-docs-configuration" title="3.4.3. Atomia DNS DynDNS configuration">Atomia DNS DynDNS configuration</a>
            </p>
          </li><li class="listitem">
            <p>
              <a class="link" href="usage.html#usage-dyndns-docs-installation" title="3.4.4. Atomia DNS DynDNS installation">Atomia DNS DynDNS installation</a>
            </p>
          </li><li class="listitem">
            <p>
              <a class="link" href="usage.html#usage-dyndns-docs-techinfo" title="3.4.5. Architecture">Atomia DNS DynDNS technical information</a>
            </p>
          </li><li class="listitem">
            <p>
              <a class="link" href="usage.html#usage-dyndns-docs-updates" title="3.4.6. Atomia DNS DynDNS updates">Atomia DNS DynDNS updates</a>
            </p>
          </li><li class="listitem">
            <p>
              <a class="link" href="usage.html#usage-dyndns-docs-usage" title="3.4.7. Client applications">Atomia DNS DynDNS usage</a>
            </p>
          </li></ul></div>
      </div>
      <div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="usage-dyndns-docs-configuration"></a>3.4.3. Atomia DNS DynDNS configuration</h4></div></div></div>
        
        <p>You have to configure the Atomia DNS DynDNS server to fit your environment.</p>
        <div class="section"><div class="titlepage"><div><div><h5 class="title"><a id="usage-dyndns-docs-configuration-file"></a>3.4.3.1. Configuration file</h5></div></div></div>
          
          <p>
            The config file used by Atomia DNS DynDNS is placed in
            <code class="code">/etc/atomiadns.conf</code>
            and contains the following settings:
          </p>
          <table id="id1306382">
            <colgroup></colgroup>
            <thead>
              <tr>
                <td>
                  <p>Parameter</p>
                </td>
                <td>
                  <p>Example</p>
                </td>
                <td>
                  <p>Description</p>
                </td>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>
                  <p>soap_uri</p>
                </td>
                <td>
                  <p>
                    <a class="ulink" href="http://hostname.of.your.soap.server/atomiadns" target="_top">http://hostname.of.your.soap.server/atomiadns</a>
                  </p>
                </td>
                <td>
                  <p>URI of the Atomia DNS API.</p>
                </td>
              </tr>
              <tr>
                <td>
                  <p>tsig_keyname</p>
                </td>
                <td>
                  <p>atomia-dns-key</p>
                </td>
                <td>
                  <p>The name of the shared key that all authorized DDNS clients needs to use.</p>
                </td>
              </tr>
              <tr>
                <td>
                  <p>tsig_key</p>
                </td>
                <td>
                  <p>ZXhhbXBsZQ==</p>
                </td>
                <td>
                  <p>The base64-encoded shared key used to authorize DDNS updates.</p>
                </td>
              </tr>
            </tbody>
          </table>
          <p>
            soap_uri and tsig_key always needs to be changed. For the other parameter, the default settings will work if used at
            
            the clients as well.
          </p>
          <p>Default config file:</p>
          <div class="informalexample">
            <pre class="programlisting">soap_uri = http://your.atomia.dns.master.server.com/atomiadns
tsig_keyname = atomia-dns-key
#tsig_key = ZXhhbXBsZQ==
            </pre>
          </div>
        </div>
        <div class="section"><div class="titlepage"><div><div><h5 class="title"><a id="usage-dyndns-docs-scripts"></a>3.4.3.2. Scripts and commands</h5></div></div></div>
          
          <p>
            For more information on how to use the Atomia DNS DynDNS server see
            <a class="link" href="usage.html#usage-dyndns-docs-usage" title="3.4.7. Client applications">Atomia DNS DynDNS usage</a>
            .
          </p>
        </div>
      </div>
      <div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="usage-dyndns-docs-installation"></a>3.4.4. Atomia DNS DynDNS installation</h4></div></div></div>
        
        <div class="section"><div class="titlepage"><div><div><h5 class="title"><a id="usage-dyndns-docs-installation-server"></a>3.4.4.1. Installing Atomia DNS DynDNS server</h5></div></div></div>
          
          <div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">
              <p>
                  Do a standard installation of Ubuntu 10.04 LTS.
              </p>
            </li><li class="listitem">
              <p>
                  	Add the Atomia APT Repository to the server using:
	                </p><pre class="programlisting">wget -q -O - http://public.apt.atomia.com/setup.sh.shtml | sed s/%distcode/`lsb_release -c | awk '{ print $2 }'`/g | sh</pre><p>
              </p>
            </li><li class="listitem">
              <p>Update all packages:</p>
              <div class="informalexample">
                <pre class="programlisting">apt-get update</pre>
              </div>
            </li><li class="listitem">
              <p>Install the Atomia DNS DynDNS server:</p>
              <div class="informalexample">
                <pre class="programlisting">apt-get install atomia-dyndns</pre>
              </div>
            </li><li class="listitem">
              <p>Edit the configuration file:</p>
              <div class="informalexample">
                <pre class="programlisting">edit /etc/atomiadns.conf</pre>
              </div>
              <div class="orderedlist"><ol class="orderedlist" type="a"><li class="listitem">
                  <p>Change the soap_uri row to contain the hostname of your Atomia DNS Master server</p>
                </li><li class="listitem">
                  <p>Add a row looking like 'tsig_key = SomeBase64_encoded_value '</p>
                </li><li class="listitem">
                  <p>Example configuration:</p>
                  <div class="informalexample">
                    <pre class="programlisting">soap_uri = http://your.atomia.dns.master.server.com/atomiadns
tsig_keyname = atomia-dns-key
tsig_key = kT6ulFA6Dg0qyRZv9vRrkA==
ver
                    </pre>
                  </div>
                </li></ol></div>
            </li><li class="listitem">
              <p>Start the DynDNS server:</p>
              <div class="informalexample">
                <pre class="programlisting">/etc/init.d/atomia-dyndns start</pre>
              </div>
            </li></ol></div>
        </div>
        <div class="section"><div class="titlepage"><div><div><h5 class="title"><a id="usage-dyndns-docs-installation-server-software"></a>3.4.4.2. Software used by Atomia DNS DynDNS</h5></div></div></div>
          
          <p>On the DynDNS server the following software is needed:</p>
          <div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
              <p>
                <span class="italics">Config::General</span>
              </p>
            </li><li class="listitem">
              <p>
                <span class="italics">SOAP::Lite</span>
              </p>
            </li><li class="listitem">
              <p>
                <span class="italics">Net::DNS</span>
              </p>
            </li></ul></div>
          <p>
            All needed software, including prerequisites are installed by the provided package,
            <span class="italics">atomia-dyndns</span>
            .
          </p>
        </div>
      </div>
      <div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="usage-dyndns-docs-techinfo"></a>3.4.5. Architecture</h4></div></div></div>
        
        <p>
          Atomia DNS DynDNS accepts DNS update requests on port 5353, authenticates them using a key shared
          
          with authorized clients and then connects to the Atomia DNS Master server to perform the needed
          
          prerequisite checks and/or updates.
        </p>
      </div>
      <div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="usage-dyndns-docs-updates"></a>3.4.6. Atomia DNS DynDNS updates</h4></div></div></div>
        
        <p>To install an update, complete the following steps:</p>
        <div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">
            <p>Update all packages:</p>
            <div class="informalexample">
              <pre class="programlisting">apt-get update</pre>
            </div>
          </li><li class="listitem">
            <p>Note the version number of the package currently installed.</p>
          </li><li class="listitem">
            <p>Install updates using:</p>
            <div class="informalexample">
              <pre class="programlisting">apt-get install atomia-dyndns
/etc/init.d/atomia-dyndns restart
              </pre>
            </div>
          </li></ol></div>
        <p>If you for some reason want to rollback to the previous version, then run:</p>
        <div class="informalexample">
          <pre class="programlisting">apt-get install atomia-dyndns=version-number-noted</pre>
        </div>
        <p>Any changes in the dependencies will be handled appropriately by the installation package, upgrading or installing them as needed.</p>
        <div class="section"><div class="titlepage"><div><div><h5 class="title"><a id="usage-dyndns-docs-updates-where"></a>3.4.6.1. Where to get updates?</h5></div></div></div>
          
          <p>
              Updates are distributed using the Atomia APT repository.
		If not done, then add the Atomia APT Repository to the server using:
		</p><pre class="programlisting">wget -q -O - http://public.apt.atomia.com/setup.sh.shtml | sed s/%distcode/`lsb_release -c | awk '{ print $2 }'`/g | sh</pre><p>
          </p>
        </div>
      </div>
      <div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="usage-dyndns-docs-usage"></a>3.4.7. Client applications</h4></div></div></div>
        
        <p>
          The Atomia DNS DynDNS application only comes with the DDNS server. To update zones using the server all
          
          standard DDNS clients, like nsupdate, can be used.
        </p>
        <p>
          The server listens on port 5353 to distinguish it from authorative nameservers (it only handles the UPDATE
          
          opcode, not other queries against the handled zones).
        </p>
        <p>Example using nsupdate (which is included with Bind):</p>
        <div class="informalexample">
          <pre class="programlisting">cat &lt;&lt;EOF | nsupdate
server your.dyndns.server 5353
zone some.zone.com
key atomia-dns-key ZXhhbXBsZQ==
prereq yxrrset somehost.some.zone.com A
update delete somehost.some.zone.com A
update add somehost.some.zone.com 300 A 127.0.0.1
send
EOF
          </pre>
        </div>
      </div>
    </div>
  </div><div xmlns="" class="footer"><p>Copyright 2012 Atomia AB. All rights reserved.</p><p class="links"><a href="http://www.atomia.com/">Atomia AB</a> | <a href="http://www.atomiadns.com/">AtomiaDNS</a> | <a href="http://www.atomia.com/blog">Blog</a> | <a href="http://www.twitter.com/atomia">Twitter</a></p></div><script xmlns="" type="text/javascript">

		  var _gaq = _gaq || [];
		  _gaq.push(['_setAccount', 'UA-11168442-3']);
		  _gaq.push(['_trackPageview']);

		  (function() {
			var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
			ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
			var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
		  })();

		</script></body></html>
